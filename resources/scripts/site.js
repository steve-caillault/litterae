class AjaxRequest{constructor(e){var t=this,n=((e=e||{}).method||"get").toLowerCase(),i=e.params||[],s="",o=[];if(-1===["get","post"].indexOf(n))throw"Méthode HTTP interdite.";if(!e.url)throw"L'URL de l'appel Ajax est manquant.";for(var l in i)o.push(encodeURI(l+"="+i[l]));o.length>0&&(s=o.join("&"));var r=function(n){t[n]=function(t){e[n]&&"function"==typeof e[n]&&e[n](t)}};r("onComplete"),r("onSuccess"),r("onError"),this.method=n.toUpperCase(),this.url=e.url,this.queryString=s,this.execute()}execute(){var e=this,t=new XMLHttpRequest;t.open(this.method,this.url),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==this.method&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onerror=function(){this.onError(this.responseText)},t.onload=function(){e.onComplete(),200===this.status?e.onResponseSuccess(this.responseText):e.onError(this.responseText)},t.send(this.queryString)}onResponseSuccess(e){self.onSuccess(e)}}class JSONAjaxRequest extends AjaxRequest{onResponseSuccess(e){var t={};try{t=JSON.parse(e)}catch(e){console.log(e)}t.status&&"SUCCESS"==t.status?this.onSuccess(t.data):this.onError(t)}}class Controller{constructor(){}execute(){}}Events={listByElement:{},add:function(e,t,n){var i=e.events(t),s=e.events();i.push(n),s[t]=i,Events.listByElement[e.signature]=s,e.htmlElement.addEventListener(t,n)},fire:function(e,t){e.events(t).forEach((function(t){t.apply(e.htmlElement)}))}};class ElementHTML{constructor(e,t,n){if(this.htmlElement=n||null,null===this.htmlElement)this.tagName=e,"text"===this.tagName?this.attributes="string"==typeof t?t:"":this.attributes="object"==typeof t?t:{},this.initHtmlElement();else if(this.tagName=n.tagName?n.tagName.toLowerCase():"text",this.attributes={},n.attributes)for(var i=0;i<n.attributes.length;i++){var s=n.attributes[i];this.attributes[s.name]=s.value}this.htmlElement.rootJSSignature||(this.htmlElement.rootJSSignature=Str.uniqueId()),this.signature=this.htmlElement.rootJSSignature}initHtmlElement(){if(null===this.htmlElement){var e=document.createElement(this.tagName);for(var t in this.attributes)"html"===t?e.innerHTML=this.attributes[t]:"text"===t?e.appendChild(document.createTextNode(this.attributes[t])):e.setAttribute(t,this.attributes[t]);this.htmlElement=e}}static searchOne(e,t){var n=(t=t||document).querySelector(e);return null===n?null:ElementHTML.retrieve(n)}static searchList(e,t){t=t||document;var n=[];return t.querySelectorAll(e).forEach((function(e){n.push(ElementHTML.retrieve(e))})),n}static retrieve(e){return new ElementHTML(null,null,e)}getPrevious(e){this._htmlElementRequired();for(var t=this.htmlElement.previousElementSibling;t;){if(t.matches(e))return ElementHTML.retrieve(t);t=t.previousElementSibling}return null}getNext(e){this._htmlElementRequired();for(var t=this.htmlElement.nextElementSibling;t;){if(t.matches(e))return ElementHTML.retrieve(t);t=t.nextElementSibling}return null}getParent(e){this._htmlElementRequired();var t=this.htmlElement;try{do{if(t.matches(e))return ElementHTML.retrieve(t);t=t.parentElement||t.parentNode}while(null!==t)}catch(e){}return null}getChild(e){return this._htmlElementRequired(),ElementHTML.searchOne(e,this.htmlElement)}getChildren(e){return this._htmlElementRequired(),ElementHTML.searchList(e,this.htmlElement)}getLast(e){this._htmlElementRequired();var t=this.getChildren(e);return t.length>0?t[t.length-1]:null}addElement(e,t="bottom"){if(this._htmlElementRequired(),-1===["bottom","before","after","top"].indexOf(t))throw"Position de l'élément incorrect.";switch(t){case"bottom":this.htmlElement.appendChild(e.htmlElement);break;case"after":this.htmlElement.parentNode.insertBefore(e.htmlElement,this.htmlElement.nextSibling);break;case"before":this.htmlElement.parentNode.insertBefore(e.htmlElement,this.htmlElement);break;case"top":this.htmlElement.hasChildNodes()?this.htmlElement.firstChild.parentNode.insertBefore(e.htmlElement,this.htmlElement.firstChild):this.htmlElement.appendChild(e.htmlElement)}return this}setProperty(e,t){return this._htmlElementRequired(),"value"==e&&"input"==this.tagName&&(this.htmlElement.value=t),"text"===e?this.htmlElement.innerText=t:this.htmlElement.setAttribute(e,t),this.attributes[e]=t,this}setProperties(e){this._htmlElementRequired();var t=this;return Object.keys(e).forEach((function(n){t.setProperty(n,e[n])})),this}getProperty(e){this._htmlElementRequired();var t=null;return"text"===e?t=this.htmlElement.innerText:e in this.htmlElement?t=this.htmlElement.value:this.attributes.hasOwnProperty(e)&&(t=this.attributes[e]),t}getSelectedElement(){return this._htmlElementRequired(),this.getChild(":checked")}addClass(e){return this._htmlElementRequired(),this.hasClass(e)?this:(this.htmlElement.classList.add(e),this)}removeClass(e){return this.htmlElement.classList.remove(e),this.setProperty("class",this.htmlElement.className),this}hasClass(e){return this.htmlElement.classList.contains(e)}events(e){var t=Events.listByElement[this.signature]||{};return e&&(t=t[e]||[]),t}addEvent(e,t){if(this._htmlElementRequired(),"function"!=typeof t)throw"La méthode de l'évenement est incorrecte.";return Events.add(this,e,t),this}addEvents(e){this._htmlElementRequired();var t=this;Object.entries(e).forEach((function([e,n]){t.addEvent(e,n)}))}fireEvent(e){this._htmlElementRequired(),Events.fire(this,e)}empty(){this._htmlElementRequired(),this.htmlElement.innerHTML=""}remove(){this._htmlElementRequired(),this.htmlElement.parentNode.removeChild(this.htmlElement)}removeChild(e){this._htmlElementRequired(),e._htmlElementRequired(),this.htmlElement.removeChild(e.htmlElement)}removeChildren(){for(this._htmlElementRequired();this.htmlElement.firstChild;)this.removeChild(ElementHTML.retrieve(this.htmlElement.firstChild))}_htmlElementRequired(){if(null===this.htmlElement)throw"L'élément n'a pas été initialisé."}}class Integer{static random(e,t){return Math.floor(Math.random()*(t-e+1))+e}}class RootJS{constructor(){}execute(){try{window.initRootJS&&"function"==typeof window.initRootJS&&window.initRootJS()}catch(e){console.log(e)}}}class Str{static replace(e,t){for(var n in t){var i=t[n];e=e.replace(n,i)}return e}static uniqueId(){var e,t,n,i,s={letter:{min:97,max:122},integer:{min:48,max:57}},o=Object.keys(s),l=Integer.random(5,10),r=[];for(n=0;n<l;n++)for(e=Integer.random(10,20),i=0;i<e;i++)t=s[o[Integer.random(0,o.length-1)]],r[n]||(r[n]=""),r[n]+=String.fromCharCode(Integer.random(t.min,t.max));return r.join("")}}class Component{constructor(e,t=!0){e.addClass("init"),this.component=e,this._loading=!1,t&&this.onReady()}onReady(){this.initEvents()}initEvents(){}loading(e){e?this.showLoading():this.hideLoading(),this._loading=e}showLoading(){}hideLoading(){}}class ManageListButton extends Component{initEvents(){var e=this;this.component.addEvent("click",(function(t){t.preventDefault(),e._loading||e.send()}))}send(){var e=this,t=this.component.getProperty("data-type"),n="add"==t?"delete":"add",i=this.component.getProperty("data-description-"+n),s="data-url-"+t;this.loading(!0),new JSONAjaxRequest({url:this.component.getProperty(s),method:"post",onComplete:function(){e.loading(!1)},onSuccess:function(t){"add"==n?e.component.removeClass("selected"):e.component.addClass("selected"),e.component.setProperties({"data-type":n,title:i})}})}showLoading(){this.component.addClass("loading")}hideLoading(){this.component.removeClass("loading")}}class DeleteContributor extends Component{initEvents(){var e=this;this.component.addEvent("click",(function(t){t.preventDefault(),e._loading||e.send()})),this.component.addEvent("delete",(function(){e.onDelete()}))}send(){var e=this;this.loading(!0),new JSONAjaxRequest({url:this.component.getProperty("data-url"),method:"post",onComplete:function(){e.loading(!1)},onSuccess:function(t){t&&e.component.fireEvent("delete")}})}onDelete(){var e=this.component.getParent("table");this.component.getParent("tr.line").remove(),0==e.getChildren("tr.line").length&&e.remove()}showLoading(){this.component.getParent("tr.line").addClass("loading")}hideLoading(){this.component.getParent("tr.line").removeClass("loading")}}class AddContributorForm extends Component{initEvents(){var e=this;this.component.addEvent("submit",(function(t){if(t.preventDefault(),!e._loading){var n=ElementHTML.retrieve(this).getChild("input.autocomplete-value").getProperty("value");n&&e.send(n)}}))}send(e){var t=this,n={};n[this.component.getProperty("data-input-name")]=e,n.form_name=this.component.getChild("input[name=form_name]").getProperty("value"),this.loading(!0),new JSONAjaxRequest({url:this.component.getProperty("data-add-contributor-url"),method:"post",params:n,onComplete:function(){t.loading(!1)},onSuccess:function(e){var n=e.contributor;n&&t.addContributor(n)}})}addContributor(e){var t=this.component.getProperty("data-contributor-type"),n=ElementHTML.searchOne("div.contributor-"+t+"-collection"),i=n.getChild("table"),s=new ElementHTML("a",{href:e.editURL,title:"Modifier "+e.name+".",text:e.name}),o=new ElementHTML("a",{href:e.deleteURL,title:"Supprimer "+e.name+".",html:"&times;","data-url":e.ajaxDeleteURL}),l=new ElementHTML("td").addElement(s),r=new ElementHTML("td",{class:"with-delete"}).addElement(o),a=new ElementHTML("tr",{class:"line"}).addElement(l).addElement(r);new DeleteContributor(o),null==i&&(i=new ElementHTML("table",{class:"without-header"}),n.addElement(i)),i.addElement(a)}showLoading(){this.component.addClass("loading")}hideLoading(){this.component.removeClass("loading")}}class FormAutocomplete extends Component{constructor(e,t=!1){super(e,t),this.component.addClass("init"),this.choices=null,this.inputs={search:ElementHTML.searchOne("input.autocomplete-text",this.component.htmlElement),value:ElementHTML.searchOne("input.autocomplete-value",this.component.htmlElement)},this.onReady()}initEvents(){var e=this,t=this.inputs.search;t.addEvent("input",(function(t){var n=this.value,i=n.length;0==i?e.inputs.value.setProperty("value",""):i>2&&!e._loading&&e.request(n)})),t.addEvent("keyup",(function(t){var n=t.key,i=-1!=["ArrowUp","ArrowDown"].indexOf(n);ElementHTML.retrieve(this).getProperty("value").length;if("ArrowRight"==n){var s=null!=e.choices?ElementHTML.searchOne("li.target",e.choices.htmlElement):null;null!=s&&s.fireEvent("select")}else i&&null!=e.choices&&e.navigation(n)})),t.addEvent("blur",(function(t){null!=e.choices&&(e.choices.addClass("hide"),setTimeout((function(){e.deleteChoices()}),500))}))}showLoading(){this.component.addClass("loading")}hideLoading(){this.component.removeClass("loading")}request(){var e=this;this.loading(!0),this.deleteChoices(),new JSONAjaxRequest({url:this.component.getProperty("data-url"),method:"post",params:{value:this.inputs.search.getProperty("value"),model:this.inputs.search.getProperty("data-model")},onComplete:function(){e.loading(!1)},onSuccess:function(t){if(t.length>0){var n=new ElementHTML("ul",{class:"autocomplete-choices hide"});t.forEach((function(t){var i=new ElementHTML("li",{class:"autocomplete-choice","data-value":t.value,text:t.text});e.initChoice(i),n.addElement(i)})),e.choices=n,e.component.addElement(n),setTimeout((function(){n.removeClass("hide")}),500)}}})}initChoice(e){var t=this;e.addEvent("select",(function(e){var n=ElementHTML.retrieve(this),i=n.getProperty("data-value"),s=n.getProperty("text");t.inputs.value.setProperty("value",i),t.inputs.search.setProperty("value",s),t.choices.addClass("hide"),setTimeout((function(){t.deleteChoices()}),500)})),e.addEvent("click",(function(){ElementHTML.retrieve(this);e.fireEvent("select")})),e.addEvent("mouseover",(function(){var e=ElementHTML.retrieve(this);ElementHTML.searchList("li",e.getParent("ul").htmlElement).forEach((function(e){e.removeClass("target")})),e.addClass("target")}))}deleteChoices(){var e=this.choices;e&&(this.choices=null,e.remove())}navigation(e){var t=ElementHTML.searchList("li",this.choices.htmlElement),n=ElementHTML.searchOne("li.target",this.choices.htmlElement),i=null;t.length<1||(null!=n&&(n.removeClass("target"),i="ArrowUp"==e?n.getPrevious("li"):n.getNext("li")),null==i&&(i="ArrowUp"==e?this.choices.getLast("li"):this.choices.getChild("li")),i.addClass("target"))}}class Slideshow extends Component{constructor(e,t){super(e,t),this.currentDoubleClick=!1,this.imageSelector="div.item"}initEvents(){var e=this;this.component.addEvent("click",(function(t){t.preventDefault(),setTimeout((function(){e.currentDoubleClick||e.showNextImage()}),200)})),this.component.addEvent("dblclick",(function(t){e.currentDoubleClick=!0,e.showZoomImage(),setTimeout((function(){e.currentDoubleClick=!1}),500)}))}showZoomImage(){var e=this.component.getChild(this.imageSelector+":not(.hidden)"),t=null==e?null:e.getProperty("data-url");null!=e&&window.open(t)}showNextImage(){var e=this.component.getChild(this.imageSelector+":not(.hidden)"),t=e.getNext(this.imageSelector+".hidden");null==t&&(t=this.component.getChild(this.imageSelector+".hidden")),null!=t&&(e.addClass("hidden"),t.removeClass("hidden"))}}var initRootJS=function(){ElementHTML.searchList("div.autocomplete-search:not(.init)").forEach((function(e){new FormAutocomplete(e)})),ElementHTML.searchList("div.slideshow:not(.init)").forEach((function(e){new Slideshow(e)})),ElementHTML.searchList("button.manage-list").forEach((function(e){new ManageListButton(e)})),ElementHTML.searchList("form.add-contributor-form").forEach((function(e){new AddContributorForm(e)})),ElementHTML.searchList("div.contributor-collection td.with-delete a").forEach((function(e){new DeleteContributor(e)}))};document.addEventListener("DOMContentLoaded",(function(){(new RootJS).execute()}),!1);